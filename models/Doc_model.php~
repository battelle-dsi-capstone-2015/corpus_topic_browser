<?php 

class Doc_model extends CI_Model {
  
    function __construct()
    {
        parent::__construct();
    }
	
	function get_list() 
	{
		$this->db->from('doc');
		$this->db->order_by("topic_entropy", "desc");
		$query = $this->db->get(); 
		return $query->result();
	}
	
	function get_item($doc_id)
	{
		$q = $this->db->query("SELECT title, year, authors, abstract, doi, cite_count FROM src_all_doi WHERE doc_id = ?",array($doc_id));
		return $q->row_array();
	}
	
	function get_topics($doc_id, $limit = 10)
	{
	    $values = array();
	    $q1 = $this->db->query("SELECT doc_id, topic_id, topic_weight FROM doctopic_long WHERE doc_id = ? AND topic_weight >= 0.05 ORDER BY topic_weight DESC LIMIT $limit", array($doc_id));
	    foreach($q1->result_array() as $r1) {
	        $q2 = $this->db->query("SELECT topic_words FROM topic WHERE topic_id = ?",array($r1 ['topic_id']));
	        $r2 = $q2->row_array();
	        $values[] = array(
	            'topic_id'      => $r1['topic_id'], 
	            'topic_weight'  => $r1['topic_weight'], 
	            'topic_words'   => $r2['topic_words']
	        );
	    }
	    return $values;
	}
	
	function get_words($doc_id)
	{
	    return "WORDS";
	}
	
	function get_docs($doc_id)
	{
	    return "DOCS";
	}
	
	function get_topic_distro($doc_id)
	{
		$q = $this->db->query("SELECT d.topic_id as 'topic_id', t.topic_words as 'topic_words', ROUND(d.topic_weight,2) as 'topic_weight' FROM doctopic_long d JOIN topic t USING (topic_id) WHERE d.doc_id = ? ORDER BY d.topic_weight DESC LIMIT 10",array($doc_id));
		return $q->result_array();
	}
    
}